<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Builder</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h2>Bot Builder</h2>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="create">
                    <i class="fas fa-plus"></i>
                    <span>Create Bot</span>
                </a>
                <a href="#" class="nav-item" data-page="library">
                    <i class="fas fa-book"></i>
                    <span>Bot Library</span>
                </a>
                <a href="#" class="nav-item" data-page="flow">
                    <i class="fas fa-project-diagram"></i>
                    <span>Flow Builder</span>
                </a>
                <a href="#" class="nav-item" data-page="tools">
                    <i class="fas fa-tools"></i>
                    <span>Tool Library</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <div class="page-header">
                    <div class="header-content">
                        <div class="header-info">
                            <div class="header-icon">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <div>
                                <h1>Dashboard</h1>
                                <p>Welcome to your bot management center</p>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="navigateTo('create')">
                            <i class="fas fa-plus"></i>
                            Create New Bot
                        </button>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-info">
                                    <h3>Total Bots</h3>
                                    <p class="stat-number" id="total-bots">0</p>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-robot"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-info">
                                    <h3>Active Tools</h3>
                                    <p class="stat-number" id="total-tools">0</p>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-tools"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-info">
                                    <h3>Flows Created</h3>
                                    <p class="stat-number" id="total-flows">0</p>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-project-diagram"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="recent-section">
                        <h2>Recent Bots</h2>
                        <div id="recent-bots" class="bots-grid">
                            <div class="empty-state">
                                <i class="fas fa-robot"></i>
                                <p>No Recent Bots</p>
                                <small>Create your first bot to get started</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Bot Page -->
            <div id="create-page" class="page">
                <div class="page-header">
                    <div class="header-content">
                        <div class="header-info">
                            <div class="header-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div>
                                <h1 id="create-title">Create Bot</h1>
                                <p>Design and configure your intelligent agent</p>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-outline" onclick="testBot()">
                                <i class="fas fa-play"></i>
                                Test Bot
                            </button>
                            <button class="btn btn-primary" onclick="saveBot()">
                                <i class="fas fa-save"></i>
                                <span id="save-btn-text">Save Bot</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="create-content">
                    <form id="bot-form" class="bot-form">
                        <div class="form-section">
                            <h2>Bot Details</h2>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="bot-name">Bot Name</label>
                                    <input type="text" id="bot-name" name="name" placeholder="Enter bot name..." required>
                                </div>
                                <div class="form-group">
                                    <label for="bot-description">Description</label>
                                    <textarea id="bot-description" name="description" placeholder="Describe what your bot does..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="form-sections-grid">
                            <div class="form-section">
                                <div class="section-header">
                                    <h2>
                                        <i class="fas fa-tools"></i>
                                        Tools
                                    </h2>
                                    <div class="section-actions">
                                        <button type="button" class="btn btn-outline btn-sm" onclick="openToolLibrary()">
                                            <i class="fas fa-cog"></i>
                                            Manage Tools
                                        </button>
                                        <button type="button" class="btn btn-outline btn-sm" onclick="openCreateTool()">
                                            <i class="fas fa-plus"></i>
                                            Create Tool
                                        </button>
                                    </div>
                                </div>
                                <div id="selected-tools" class="selected-tools">
                                    <div class="empty-state">
                                        <i class="fas fa-tools"></i>
                                        <p>No Tools Selected</p>
                                        <small>Select tools from the library or create a new one</small>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h2>LLM Model</h2>
                                <div class="model-selection">
                                    <div class="radio-group">
                                        <label class="radio-item">
                                            <input type="radio" name="model" value="Gemini" checked>
                                            <span>Gemini</span>
                                        </label>
                                        <label class="radio-item">
                                            <input type="radio" name="model" value="OpenAI">
                                            <span>OpenAI</span>
                                        </label>
                                        <label class="radio-item">
                                            <input type="radio" name="model" value="Deepseek">
                                            <span>Deepseek</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="config-section">
                                    <div class="config-item">
                                        <div class="config-header">
                                            <div>
                                                <label>Agent Prompt</label>
                                                <small>Configure the system prompt that defines your agent's behavior</small>
                                            </div>
                                            <button type="button" class="btn btn-outline btn-sm" onclick="openPromptDialog()">
                                                <i class="fas fa-file-text"></i>
                                                Configure
                                            </button>
                                        </div>
                                        <div id="prompt-preview" class="config-preview" style="display: none;">
                                            <p id="prompt-text"></p>
                                        </div>
                                    </div>

                                    <div class="config-item">
                                        <div class="config-header">
                                            <div>
                                                <label>Message Configuration</label>
                                                <small>Configure welcome, closing, and re-engagement messages</small>
                                            </div>
                                            <button type="button" class="btn btn-outline btn-sm" onclick="openMessageDialog()">
                                                <i class="fas fa-comments"></i>
                                                Configure
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bot Library Page -->
            <div id="library-page" class="page">
                <div class="page-header">
                    <div class="header-content">
                        <div class="header-info">
                            <div class="header-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div>
                                <h1>Bot Library</h1>
                                <p>Manage and organize your created bots</p>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="navigateTo('create')">
                            <i class="fas fa-robot"></i>
                            Create Bot
                        </button>
                    </div>
                </div>

                <div class="library-content">
                    <div class="search-section">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="bot-search" placeholder="Search bots by name or description..." onkeyup="filterBots()">
                        </div>
                    </div>

                    <div id="bots-container" class="bots-grid">
                        <div class="empty-state">
                            <i class="fas fa-robot"></i>
                            <p>No Bots Available</p>
                            <small>Create your first bot to get started</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flow Builder Page -->
            <div id="flow-page" class="page">
                <div class="flow-builder">
                    <div class="flow-sidebar">
                        <div class="flow-header">
                            <div class="header-icon">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div>
                                <h2>Flow Builder</h2>
                                <p>Design agent workflows</p>
                            </div>
                        </div>

                        <div class="flow-controls">
                            <div class="form-group">
                                <label for="flow-name">Flow Name</label>
                                <input type="text" id="flow-name" value="Untitled Flow" placeholder="Enter flow name...">
                            </div>

                            <div class="flow-actions">
                                <button class="btn btn-primary btn-sm" onclick="saveFlow()">
                                    <i class="fas fa-save"></i>
                                    Save
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="runFlow()">
                                    <i class="fas fa-play"></i>
                                    Run
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportFlow()">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>

                        <div class="available-bots">
                            <h3>Available Bots</h3>
                            <div id="flow-bots-list" class="bots-list">
                                <div class="empty-state">
                                    <i class="fas fa-robot"></i>
                                    <p>No Bots Available</p>
                                    <small>Create bots first to use in flows</small>
                                </div>
                            </div>
                        </div>

                        <div class="flow-stats">
                            <h3>Flow Statistics</h3>
                            <div class="stats-list">
                                <div class="stat-item">
                                    <span>Nodes:</span>
                                    <span id="nodes-count">0</span>
                                </div>
                                <div class="stat-item">
                                    <span>Connections:</span>
                                    <span id="connections-count">0</span>
                                </div>
                                <div class="stat-item">
                                    <span>Status:</span>
                                    <span class="status-ready">Ready</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flow-canvas">
                        <canvas id="flowCanvas" width="800" height="600"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tools Page -->
            <div id="tools-page" class="page">
                <div class="page-header">
                    <div class="header-content">
                        <div class="header-info">
                            <div class="header-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div>
                                <h1>Tool Library</h1>
                                <p>Manage your bot tools and functions</p>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="openCreateTool()">
                            <i class="fas fa-plus"></i>
                            Create Tool
                        </button>
                    </div>
                </div>

                <div class="tools-content">
                    <div id="tools-container" class="tools-grid">
                        <div class="empty-state">
                            <i class="fas fa-tools"></i>
                            <p>No Tools Available</p>
                            <small>Create your first tool to get started</small>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Modals -->
    <div id="tool-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="tool-modal-title">Create Tool</h2>
                <button class="modal-close" onclick="closeModal('tool-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="tool-form">
                    <div class="form-group">
                        <label for="tool-name">Tool Name</label>
                        <input type="text" id="tool-name" name="name" placeholder="Enter tool name..." required>
                    </div>
                    <div class="form-group">
                        <label for="tool-description">Description</label>
                        <textarea id="tool-description" name="description" placeholder="Describe what this tool does..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="tool-code">JavaScript Code</label>
                        <textarea id="tool-code" name="code" placeholder="function myTool(input) {&#10;  // Your code here&#10;  return result;&#10;}" rows="10"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('tool-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveTool()">
                    <span id="tool-save-text">Create Tool</span>
                </button>
            </div>
        </div>
    </div>

    <div id="prompt-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Agent Prompt</h2>
                <button class="modal-close" onclick="closeModal('prompt-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="agent-prompt">System Prompt</label>
                    <textarea id="agent-prompt" placeholder="Enter the system prompt that defines your agent's behavior..." rows="10"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('prompt-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="savePrompt()">Save Prompt</button>
            </div>
        </div>
    </div>

    <div id="message-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Configure Voice Bot Messages</h2>
                <button class="modal-close" onclick="closeModal('message-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="message-config">
                    <div class="config-section">
                        <h3>Welcome / Trigger Message</h3>
                        <p class="config-description">Provides a customizable greeting to engage users and set the tone for their interaction.</p>
                        <textarea id="welcome-message" rows="3" placeholder="Thank you for calling..."></textarea>
                    </div>

                    <div class="config-section">
                        <h3>Re-Engage Messages</h3>
                        <p class="config-description">Configure bot behaviour when the customer is not responding or goes silent</p>
                        <div id="reengage-messages" class="reengage-container">
                            <div class="reengage-message">
                                <div class="reengage-inputs">
                                    <input type="number" value="30" min="10" max="300" placeholder="Time (seconds)">
                                    <input type="text" placeholder="Re-engage message">
                                    <button type="button" class="btn-remove" onclick="removeReengageMessage(0)">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline btn-sm" onclick="addReengageMessage()">
                            <i class="fas fa-plus"></i>
                            Add
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>Closing / Ending Message</h3>
                        <p class="config-description">Provides a customizable closing message before disconnecting the call</p>
                        <textarea id="closing-message" rows="3" placeholder="Thank you for choosing..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('message-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveMessageConfig()">Save</button>
            </div>
        </div>
    </div>

    <div id="tool-library-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Tool Library</h2>
                <button class="modal-close" onclick="closeModal('tool-library-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="tool-library-content" class="tool-library-grid">
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <p>No Tools Available</p>
                        <small>Create tools first to add them to bots</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('tool-library-modal')">Done</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/components.js"></script>
    <script src="js/flow-builder.js"></script>
    <script src="js/app.js"></script>
</body>
</html>